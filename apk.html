<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No Ads APK</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            padding: 20px 0;
        }

        .back-button {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            text-decoration: none;
            color: #4a6bff;
            font-weight: 500;
            padding: 10px 20px;
            border-radius: 8px;
            border: 2px solid #4a6bff;
            transition: all 0.3s ease;
            background: white;
        }

        .back-button:hover {
            background-color: #4a6bff;
            color: white;
            transform: translateY(-50%) translateX(-5px);
        }

        h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .loading {
            font-size: 1.1rem;
            color: #666;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            display: inline-block;
            margin-top: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* App Details Container */
        .app-details-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* App Details Card */
        .app-details-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* App Header */
        .app-header {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 30px;
            padding-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
            margin-bottom: 30px;
        }

        .app-details-icon {
            width: 120px;
            height: 120px;
            border-radius: 25px;
            object-fit: cover;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            flex-shrink: 0;
        }

        .app-basic-info {
            flex: 1;
            min-width: 300px;
        }

        .app-basic-info h2 {
            font-size: 2.2rem;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .app-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 15px;
        }

        .meta-item {
            background: #f8f9fa;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.95rem;
            border-left: 3px solid #4a6bff;
        }

        .meta-item strong {
            color: #4a6bff;
            margin-right: 5px;
        }

        /* Download Section */
        .download-section {
            text-align: center;
            min-width: 200px;
        }

        .download-btn {
            display: inline-block;
            background: linear-gradient(135deg, #4a6bff, #6a8bff);
            color: white;
            text-decoration: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(74, 107, 255, 0.3);
            border: none;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .download-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(74, 107, 255, 0.4);
            background: linear-gradient(135deg, #3a5bef, #5a7bff);
        }

        .file-size {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* Content Sections */
        .content-section {
            margin-bottom: 35px;
            padding-bottom: 30px;
            border-bottom: 1px solid #eee;
        }

        .content-section:last-of-type {
            border-bottom: none;
        }

        .content-section h3 {
            font-size: 1.5rem;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4a6bff;
            display: inline-block;
            font-weight: 600;
        }

        .content-text {
            font-size: 1.05rem;
            line-height: 1.8;
            color: #444;
            background: #fafbff;
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid #4a6bff;
        }

        .content-text a {
            color: #4a6bff;
            text-decoration: none;
            font-weight: 500;
        }

        .content-text a:hover {
            text-decoration: underline;
        }

        /* Description */
        .app-description {
            margin-bottom: 35px;
            padding: 25px;
            background: linear-gradient(to right, #f8f9ff, #ffffff);
            border-radius: 12px;
            border: 1px solid #e6e9ff;
        }

        .app-description h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .app-description p {
            color: #555;
            font-size: 1.1rem;
            line-height: 1.7;
        }

        /* No Content Message */
        .no-content-message {
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 12px;
            margin: 30px 0;
            color: #666;
            border: 2px dashed #ddd;
        }

        /* App Footer */
        .app-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 30px;
            border-top: 2px solid #f0f0f0;
            margin-top: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .back-to-list-btn {
            text-decoration: none;
            color: #666;
            font-weight: 500;
            padding: 12px 25px;
            border-radius: 8px;
            border: 2px solid #ddd;
            transition: all 0.3s ease;
        }

        .back-to-list-btn:hover {
            background: #f8f9fa;
            border-color: #4a6bff;
            color: #4a6bff;
        }

        .last-updated {
            color: #888;
            font-size: 0.9rem;
        }

        /* Error Container */
        .error-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .error-card {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            border: 2px solid #ff6b6b;
        }

        .error-card h3 {
            color: #ff6b6b;
            font-size: 1.8rem;
            margin-bottom: 20px;
        }

        .error-card p {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 30px;
        }

        .error-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .error-btn {
            padding: 12px 25px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .error-btn:first-child {
            background: #4a6bff;
            color: white;
            border: 2px solid #4a6bff;
        }

        .error-btn:last-child {
            background: white;
            color: #4a6bff;
            border: 2px solid #4a6bff;
        }

        .error-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .error-tips {
            text-align: left;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-top: 25px;
        }

        .error-tips h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .error-tips ul {
            list-style-position: inside;
            color: #666;
        }

        .error-tips li {
            margin-bottom: 8px;
            padding-left: 10px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            header {
                padding: 60px 0 20px;
            }

            .back-button {
                position: static;
                transform: none;
                display: inline-block;
                margin-bottom: 20px;
            }

            h1 {
                font-size: 2rem;
            }

            .app-details-card {
                padding: 25px;
            }

            .app-header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }

            .app-basic-info {
                min-width: auto;
            }

            .app-details-icon {
                width: 100px;
                height: 100px;
            }

            .app-meta {
                justify-content: center;
            }

            .app-footer {
                flex-direction: column;
                text-align: center;
            }

            .download-btn {
                width: 100%;
                padding: 15px;
            }

            .error-actions {
                flex-direction: column;
            }

            .error-btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem;
            }

            .app-basic-info h2 {
                font-size: 1.8rem;
            }

            .content-section h3 {
                font-size: 1.3rem;
            }

            .content-text {
                padding: 15px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="back-button">← Back to All Apps</a>
        <h1>App Details</h1>
        <div id="loading-indicator" class="loading">Loading app details...</div>
    </header>

    <main>
        <div id="app-details-container" class="app-details-container">
            <!-- App details will be loaded here -->
        </div>
        
        <div id="error-container" class="error-container" style="display: none;">
            <!-- Error messages will appear here -->
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // JavaScript Code
        document.addEventListener('DOMContentLoaded', () => {
            // Get app name from URL query parameter
            const urlParams = new URLSearchParams(window.location.search);
            const appName = urlParams.get('app');
            
            if (!appName) {
                showError('No app specified. Please select an app from the home page.');
                return;
            }
            
            loadAppDetails(appName);
        });

        async function loadAppDetails(appName) {
            const loadingIndicator = document.getElementById('loading-indicator');
            const appContainer = document.getElementById('app-details-container');
            const errorContainer = document.getElementById('error-container');
            
            loadingIndicator.textContent = `Loading details for "${appName}"...`;
            errorContainer.style.display = 'none';
            appContainer.innerHTML = '';

            try {
                // Load Excel data
                const response = await fetch('./noadsapk.xlsx');
                
                if (!response.ok) {
                    throw new Error(`Failed to load app data. HTTP status: ${response.status}`);
                }

                const data = await response.arrayBuffer();
                const workbook = XLSX.read(new Uint8Array(data), { type: 'array' });
                const sheetName = workbook.SheetNames[0];
                const sheetData = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);

                // Find the specific app
                const appData = sheetData.find(row => row.Name === appName);
                
                if (!appData) {
                    throw new Error(`App "${appName}" not found in the database.`);
                }

                // Prepare app object
                const app = {
                    id: appData.Id || 'N/A',
                    name: appData.Name || 'N/A',
                    developer: appData.Developer || 'N/A',
                    version: appData.Version || 'N/A',
                    downloadLink: appData.Download || '#',
                    description: appData.Description || 'No description available.'
                };

                // Load additional content files
                const [aboutContent, privacyContent] = await Promise.all([
                    loadTextFile(`app/${app.name}/about.txt`),
                    loadTextFile(`app/${app.name}/privacy.txt`)
                ]);

                // Update page title
                document.title = `${app.name} - No Ads APK`;

                // Create app details HTML
                appContainer.innerHTML = createAppDetailsHTML(app, aboutContent, privacyContent);
                
                // Hide loading indicator
                loadingIndicator.style.display = 'none';

            } catch (error) {
                console.error('Error loading app details:', error);
                loadingIndicator.style.display = 'none';
                showError(`Failed to load app details: ${error.message}`);
            }
        }

        async function loadTextFile(filePath) {
            try {
                const response = await fetch(filePath);
                
                if (!response.ok) {
                    if (response.status === 404) {
                        console.log(`Note: ${filePath} not found (this is normal if file doesn't exist)`);
                        return null;
                    }
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const text = await response.text();
                return text.trim() || null;
                
            } catch (error) {
                console.log(`Could not load ${filePath}:`, error.message);
                return null;
            }
        }

        function createAppDetailsHTML(app, aboutContent, privacyContent) {
            const iconPath = `app/${app.name}/icon.jpg`;
            const defaultIcon = 'https://via.placeholder.com/150/cccccc/666666?text=No+Icon';
            
            return `
                <div class="app-details-card">
                    <div class="app-header">
                        <img src="${iconPath}" 
                             alt="${app.name} Icon" 
                             class="app-details-icon"
                             onerror="this.src='${defaultIcon}'; this.onerror=null;">
                        
                        <div class="app-basic-info">
                            <h2>${app.name}</h2>
                            <div class="app-meta">
                                <span class="meta-item">
                                    <strong>Version:</strong> ${app.version}
                                </span>
                                <span class="meta-item">
                                    <strong>Developer:</strong> ${app.developer}
                                </span>
                                <span class="meta-item">
                                    <strong>ID:</strong> ${app.id}
                                </span>
                            </div>
                        </div>
                        
                        <div class="download-section">
                            <a href="${app.downloadLink}" 
                               target="_blank" 
                               class="download-btn"
                               ${app.downloadLink === '#' ? 'style="opacity:0.5; cursor:not-allowed;"' : ''}>
                                ${app.downloadLink === '#' ? 'Download Coming Soon' : 'Download APK'}
                            </a>
                            ${app.downloadLink !== '#' ? 
                                `<p class="file-size">Direct download link</p>` : 
                                ''}
                        </div>
                    </div>
                    
                    <div class="app-description">
                        <h3>Description</h3>
                        <p>${app.description}</p>
                    </div>
                    
                    ${aboutContent ? `
                    <div class="content-section">
                        <h3>About This App</h3>
                        <div class="content-text">${formatTextContent(aboutContent)}</div>
                    </div>` : ''}
                    
                    ${privacyContent ? `
                    <div class="content-section">
                        <h3>Privacy Policy</h3>
                        <div class="content-text">${formatTextContent(privacyContent)}</div>
                    </div>` : ''}
                    
                    ${!aboutContent && !privacyContent ? `
                    <div class="no-content-message">
                        <p>Additional information files (about.txt, privacy.txt) are not available for this app.</p>
                    </div>` : ''}
                    
                    <div class="app-footer">
                        <a href="index.html" class="back-to-list-btn">← Back to All Apps</a>
                        <p class="last-updated">Data loaded from local Excel file</p>
                    </div>
                </div>
            `;
        }

        function formatTextContent(text) {
            // Convert line breaks to <br>, URLs to links, and preserve formatting
            if (!text) return '';
            return text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/\n/g, '<br>')
                .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" rel="noopener">$1</a>');
        }

        function showError(message) {
            const errorContainer = document.getElementById('error-container');
            const loadingIndicator = document.getElementById('loading-indicator');
            
            loadingIndicator.style.display = 'none';
            errorContainer.innerHTML = `
                <div class="error-card">
                    <h3>⚠️ Error Loading App</h3>
                    <p>${message}</p>
                    <div class="error-actions">
                        <a href="index.html" class="error-btn">Go Back to App List</a>
                        <button onclick="location.reload()" class="error-btn">Try Again</button>
                    </div>
                    <div class="error-tips">
                        <h4>Troubleshooting Tips:</h4>
                        <ul>
                            <li>Make sure the Excel file "noadsapk.xlsx" exists in the project folder</li>
                            <li>Check if the app folder exists in the "app/" directory</li>
                            <li>Verify the app name in the URL is correct</li>
                            <li>Run the site on a local server (not file:// protocol)</li>
                        </ul>
                    </div>
                </div>
            `;
            errorContainer.style.display = 'block';
        }

        // Handle back button with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                window.location.href = 'index.html';
            }
        });

        // Handle browser back/forward buttons
        window.addEventListener('popstate', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const appName = urlParams.get('app');
            if (appName) {
                loadAppDetails(appName);
            }
        });
    </script>
</body>
</html>
